<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Analytics Hub - LEONI Quality Intelligence</title>
    <link rel="icon" href="../assets/logo.png?v=2025" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #2d3748;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1a202c, #2d3748);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100"><path fill="rgba(255,255,255,0.1)" d="M0,0v50c250,0,250-50,500-50s250,50,500,50V0H0z"/></svg>');
            background-size: cover;
        }

        .header h1 {
            position: relative;
            z-index: 1;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            position: relative;
            z-index: 1;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .ai-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 2;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            margin-bottom: 25px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #4a5568;
            font-size: 0.9rem;
        }

        select, input {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .stat-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .rft-stat .stat-icon { background: linear-gradient(135deg, #48bb78, #38a169); }
        .cpk-stat .stat-icon { background: linear-gradient(135deg, #4299e1, #3182ce); }
        .fpy-stat .stat-icon { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .ppm-stat .stat-icon { background: linear-gradient(135deg, #e53e3e, #c53030); }
        .audit-stat .stat-icon { background: linear-gradient(135deg, #805ad5, #6b46c1); }
        .efficiency-stat .stat-icon { background: linear-gradient(135deg, #38b2ac, #319795); }

        .stat-title {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-value {
            font-size: 42px;
            font-weight: 800;
            color: #1a202c;
            margin: 15px 0;
            position: relative;
        }

        .stat-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: rgba(247, 250, 252, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .stat-item-label {
            font-size: 11px;
            color: #4a5568;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-item-value {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin-top: 4px;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 13px;
            padding: 6px 12px;
            border-radius: 20px;
            margin-left: 15px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .trend-up { background: linear-gradient(135deg, #fed7d7, #feb2b2); color: #c53030; }
        .trend-down { background: linear-gradient(135deg, #c6f6d5, #9ae6b4); color: #2f855a; }
        .trend-stable { background: linear-gradient(135deg, #e2e8f0, #cbd5e0); color: #4a5568; }

        .chart-section {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .chart-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            display: flex;
            align-items: center;
        }

        .chart-title i {
            margin-right: 12px;
            color: #667eea;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            color: #4a5568;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-btn:hover, .chart-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .ai-insights {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .ai-insights h3 {
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .ai-insights i {
            margin-right: 10px;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            backdrop-filter: blur(10px);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .alert-panel {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border: 2px solid #fc8181;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .alert-panel h4 {
            color: #c53030;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .alert-panel i {
            margin-right: 8px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .performance-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .update-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .update-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }

        .navigation {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: flex;
            align-items: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .nav-btn i {
            margin-right: 10px;
        }

        .nav-entry { background: linear-gradient(135deg, #48bb78, #38a169); }
        .nav-aql { background: linear-gradient(135deg, #4299e1, #3182ce); }
        .nav-dashboard { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .nav-5s { background: linear-gradient(135deg, #805ad5, #6b46c1); }
        .nav-afp { background: linear-gradient(135deg, #38b2ac, #319795); }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                grid-row: 1;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .control-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="ai-badge">
                <i class="fas fa-robot"></i> AI-Powered Analytics
            </div>
            <h1><i class="fas fa-brain"></i>  Analytics Hub</h1>
            <p>Advanced Quality Intelligence & Performance Analytics for Quality Production</p>
        </div>

        <div class="dashboard-grid">
            <div class="main-content">
                <div class="controls">
                    <div class="control-row">
                        <div class="form-group">
                            <label for="lineSelect"><i class="fas fa-industry"></i> Production Line</label>
                            <select id="lineSelect">
                                <option value="ALL">All Lines</option>
                                <option value="VCE">VCE Line (Volvo Cable Engine)</option>
                                <option value="HDEP-C1">HDEP C1 (Heavy Duty Engine)</option>
                                <option value="HDEP-C2">HDEP C2 (Heavy Duty Plus)</option>
                                <option value="HDEP-C3">HDEP C3 (Heavy Duty Premium)</option>
                                <option value="MDEP">MDEP (Medium Duty Engine)</option>
                                <option value="HAULER">HAULER (Transport Systems)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="periodSelect"><i class="fas fa-calendar-alt"></i> Analysis Period</label>
                            <select id="periodSelect">
                                <option value="7">Last 7 Days</option>
                                <option value="14">Last 14 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="180">Last 6 Months</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shiftSelect"><i class="fas fa-clock"></i> Shift Analysis</label>
                            <select id="shiftSelect">
                                <option value="ALL">All Shifts</option>
                                <option value="Morning">Morning Shift (06:00-14:00)</option>
                                <option value="Afternoon">Afternoon Shift (14:00-22:00)</option>
                                <option value="Night">Night Shift (22:00-06:00)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button onclick="updateAnalytics()" class="update-btn">
                                <i class="fas fa-sync-alt"></i> Refresh Analytics
                            </button>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card rft-stat">
                        <div class="stat-header">
                            <div class="stat-icon">✅</div>
                            <div class="stat-title">Right First Time (RFT)</div>
                        </div>
                        <div class="stat-value" id="rftAverage">--</div>
                        <div id="rftTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="rftMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="rftMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">SAMPLES</div>
                                <div class="stat-item-value" id="rftCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≥95%</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card cpk-stat">
                        <div class="stat-header">
                            <div class="stat-icon">📊</div>
                            <div class="stat-title">Process Capability (CPK)</div>
                        </div>
                        <div class="stat-value" id="cpkAverage">--</div>
                        <div id="cpkTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="cpkMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="cpkMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">SAMPLES</div>
                                <div class="stat-item-value" id="cpkCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≥1.33</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card fpy-stat">
                        <div class="stat-header">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-title">First Pass Yield (FPY)</div>
                        </div>
                        <div class="stat-value" id="fpyAverage">--</div>
                        <div id="fpyTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="fpyMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="fpyMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">SAMPLES</div>
                                <div class="stat-item-value" id="fpyCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≥95%</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card ppm-stat">
                        <div class="stat-header">
                            <div class="stat-icon">⚠️</div>
                            <div class="stat-title">Defect Rate (PPM)</div>
                        </div>
                        <div class="stat-value" id="ppmAverage">--</div>
                        <div id="ppmTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="ppmMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="ppmMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">SAMPLES</div>
                                <div class="stat-item-value" id="ppmCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≤100 PPM</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card audit-stat">
                        <div class="stat-header">
                            <div class="stat-icon">🏭</div>
                            <div class="stat-title">5S Audit Score</div>
                        </div>
                        <div class="stat-value" id="auditAverage">--</div>
                        <div id="auditTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="auditMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="auditMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">AUDITS</div>
                                <div class="stat-item-value" id="auditCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≥90%</div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card efficiency-stat">
                        <div class="stat-header">
                            <div class="stat-icon">⚡</div>
                            <div class="stat-title">Line Efficiency</div>
                        </div>
                        <div class="stat-value" id="efficiencyAverage">--</div>
                        <div id="efficiencyTrend" class="trend-indicator">Analyzing...</div>
                        <div class="stat-details">
                            <div class="stat-item">
                                <div class="stat-item-label">BEST</div>
                                <div class="stat-item-value" id="efficiencyMax">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">WORST</div>
                                <div class="stat-item-value" id="efficiencyMin">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">SAMPLES</div>
                                <div class="stat-item-value" id="efficiencyCount">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-label">TARGET</div>
                                <div class="stat-item-value">≥85%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <div class="chart-header">
                        <div class="chart-title">
                            <i class="fas fa-chart-line"></i> Performance Trends Analysis
                        </div>
                        <div class="chart-controls">
                            <button class="chart-btn active" data-metric="rft">RFT</button>
                            <button class="chart-btn" data-metric="cpk">CPK</button>
                            <button class="chart-btn" data-metric="fpy">FPY</button>
                            <button class="chart-btn" data-metric="ppm">PPM</button>
                            <button class="chart-btn" data-metric="efficiency">Efficiency</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="ai-insights">
                    <h3><i class="fas fa-robot"></i> AI Insights & Predictions</h3>
                    <div id="aiInsights">
                        <div class="insight-item">
                            <strong>🤖 Predictive Analysis:</strong><br>
                            <span id="aiPrediction">Analyzing patterns...</span>
                        </div>
                        <div class="insight-item">
                            <strong>📊 Performance Classification:</strong><br>
                            <span id="aiClassification">Processing data...</span>
                        </div>
                        <div class="insight-item">
                            <strong>⚡ Optimization Recommendation:</strong><br>
                            <span id="aiOptimization">Generating recommendations...</span>
                        </div>
                        <div class="insight-item">
                            <strong>🎯 Risk Assessment:</strong><br>
                            <span id="aiRisk">Evaluating risks...</span>
                        </div>
                    </div>
                </div>

                <div id="alertPanel" class="alert-panel" style="display: none;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Quality Alerts</h4>
                    <div id="alertContent"></div>
                </div>

                <div class="performance-grid">
                    <div class="performance-card">
                        <h4><i class="fas fa-trophy"></i> Top Performer</h4>
                        <p id="topPerformer">VCE Line - 97.8% RFT</p>
                    </div>
                    <div class="performance-card">
                        <h4><i class="fas fa-chart-bar"></i> Trend Status</h4>
                        <p id="trendStatus">↗️ Improving Overall</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <a href="technician-metrics.html" class="nav-btn nav-entry">
                <i class="fas fa-plus-circle"></i> Metrics Entry
            </a>
            <a href="quality-metrics.html" class="nav-btn nav-aql">
                <i class="fas fa-clipboard-list"></i> AQL System
            </a>
            <a href="../graphs/DashPerLine/vce-dashboard.html" class="nav-btn nav-dashboard">
                <i class="fas fa-tachometer-alt"></i> VCE Dashboard
            </a>
            <a href="../5S/5s-checklist.html" class="nav-btn nav-5s">
                <i class="fas fa-industry"></i> 5S Audit
            </a>
            <a href="../AFP/afp-audit.html" class="nav-btn nav-afp">
                <i class="fas fa-shield-alt"></i> AFP Audit
            </a>
        </div>
    </div>

    <script src="technician-metrics.js"></script>
    <script>
        // Mock AI Analytics Engine
        class AIAnalyticsEngine {
            constructor() {
                this.models = {
                    prediction: 'TechnicianPerformancePredictor v2.1',
                    classification: 'QualityClassifier v1.8',
                    optimization: 'ProcessOptimizer v3.2',
                    riskAssessment: 'RiskAnalyzer v2.5'
                };
            }

            generatePrediction(data) {
                const trends = ['improving', 'stable', 'declining'];
                const trend = trends[Math.floor(Math.random() * trends.length)];
                const confidence = 75 + Math.random() * 20;
                
                const predictions = {
                    improving: [
                        `Next week RFT expected to reach ${(96 + Math.random() * 3).toFixed(1)}% (${confidence.toFixed(0)}% confidence)`,
                        `Process capability trending upward, CPK forecasted at ${(1.4 + Math.random() * 0.3).toFixed(2)}`,
                        `Quality improvements detected, defect rate decreasing by ${(5 + Math.random() * 10).toFixed(1)}%`
                    ],
                    stable: [
                        `Performance maintaining steady state within control limits (${confidence.toFixed(0)}% confidence)`,
                        `Current quality metrics stable, no significant variations predicted`,
                        `Process control effective, maintaining target performance levels`
                    ],
                    declining: [
                        `⚠️ Potential quality degradation detected, RFT may drop to ${(88 + Math.random() * 5).toFixed(1)}%`,
                        `Process drift identified, recommend immediate corrective action`,
                        `Risk of increased defect rate by ${(15 + Math.random() * 10).toFixed(1)}% if no intervention`
                    ]
                };
                
                return predictions[trend][Math.floor(Math.random() * predictions[trend].length)];
            }

            classifyPerformance(metrics) {
                const classifications = [
                    'Excellent - All metrics exceed targets with consistent performance',
                    'Good - Performance within targets, minor variations detected',
                    'Acceptable - Meeting basic requirements, room for improvement',
                    'Needs Attention - Some metrics below targets, corrective action recommended',
                    'Critical - Multiple metrics failing, immediate intervention required'
                ];
                
                // Simulate classification based on mock performance
                const score = Math.random();
                if (score > 0.8) return classifications[0];
                if (score > 0.6) return classifications[1];
                if (score > 0.4) return classifications[2];
                if (score > 0.2) return classifications[3];
                return classifications[4];
            }

            generateOptimization(lineType) {
                const optimizations = {
                    'VCE': [
                        'Optimize cable routing to reduce assembly time by 12%',
                        'Implement automated quality checks at Pin Terminal station',
                        'Adjust crimping parameters for better first-pass yield'
                    ],
                    'HDEP': [
                        'Heavy-duty connector pre-inspection recommended',
                        'Increase torque specifications for terminal connections',
                        'Implement predictive maintenance on crimping tools'
                    ],
                    'ALL': [
                        'Cross-train operators on quality standards to improve consistency',
                        'Implement statistical process control on critical parameters',
                        'Upgrade inspection equipment for better defect detection',
                        'Standardize work instructions across all shifts'
                    ]
                };
                
                const suggestions = optimizations[lineType] || optimizations['ALL'];
                return suggestions[Math.floor(Math.random() * suggestions.length)];
            }

            assessRisk(metrics) {
                const risks = [
                    { level: 'Low', color: '#48bb78', message: 'All systems operating within normal parameters' },
                    { level: 'Medium', color: '#ed8936', message: 'Monitor trends closely, preventive action may be needed' },
                    { level: 'High', color: '#e53e3e', message: 'Immediate attention required to prevent quality issues' }
                ];
                
                const risk = risks[Math.floor(Math.random() * risks.length)];
                return `<span style="color: ${risk.color}; font-weight: bold;">${risk.level} Risk</span> - ${risk.message}`;
            }
        }

        // Mock Data Generator
        class MockDataGenerator {
            static generateTimeSeriesData(metric, days = 30) {
                const data = [];
                const now = new Date();
                let baseValue;
                
                switch(metric) {
                    case 'rft': baseValue = 94; break;
                    case 'cpk': baseValue = 1.25; break;
                    case 'fpy': baseValue = 92; break;
                    case 'ppm': baseValue = 150; break;
                    case 'efficiency': baseValue = 87; break;
                    default: baseValue = 90;
                }
                
                for (let i = days; i >= 0; i--) {
                    const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                    const trend = Math.sin(i / 10) * 2; // Cyclical trend
                    const noise = (Math.random() - 0.5) * 4; // Random variation
                    
                    let value = baseValue + trend + noise;
                    
                    // Apply metric-specific constraints
                    if (metric === 'ppm') {
                        value = Math.max(20, Math.min(500, value));
                    } else if (metric === 'cpk') {
                        value = Math.max(0.8, Math.min(2.0, value));
                    } else {
                        value = Math.max(70, Math.min(100, value));
                    }
                    
                    data.push({
                        x: date,
                        y: value
                    });
                }
                
                return data;
            }

            static generateKPIData(metric, line, period) {
                const data = this.generateTimeSeriesData(metric, period);
                const values = data.map(d => d.y);
                
                return {
                    average: values.reduce((sum, val) => sum + val, 0) / values.length,
                    min: Math.min(...values),
                    max: Math.max(...values),
                    count: values.length,
                    trend: this.calculateTrend(values),
                    data: data
                };
            }

            static calculateTrend(values) {
                if (values.length < 2) return 'stable';
                
                const recent = values.slice(-7);
                const older = values.slice(0, 7);
                
                const recentAvg = recent.reduce((sum, val) => sum + val, 0) / recent.length;
                const olderAvg = older.reduce((sum, val) => sum + val, 0) / older.length;
                
                const diff = recentAvg - olderAvg;
                const threshold = olderAvg * 0.03;
                
                if (Math.abs(diff) < threshold) return 'stable';
                return diff > 0 ? 'up' : 'down';
            }
        }

        // Chart Management
        let trendsChart = null;
        let currentMetric = 'rft';
        const aiEngine = new AIAnalyticsEngine();

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            updateAnalytics();
            updateAIInsights();
            
            // Setup chart controls
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelector('.chart-btn.active').classList.remove('active');
                    this.classList.add('active');
                    currentMetric = this.dataset.metric;
                    updateChart();
                });
            });

            // Auto-refresh every 30 seconds
            setInterval(() => {
                updateAnalytics();
                updateAIInsights();
            }, 30000);
        });

        function initializeChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            trendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Performance Trend',
                        data: [],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgb(102, 126, 234)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM dd'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function updateAnalytics() {
            const line = document.getElementById('lineSelect').value;
            const period = parseInt(document.getElementById('periodSelect').value);
            const shift = document.getElementById('shiftSelect').value;

            // Generate mock data for all metrics
            const metrics = ['rft', 'cpk', 'fpy', 'ppm', 'audit', 'efficiency'];
            
            metrics.forEach(metric => {
                const data = MockDataGenerator.generateKPIData(metric, line, period);
                updateMetricDisplay(metric, data);
            });

            updateChart();
            updateAlerts();
        }

        function updateMetricDisplay(metricType, data) {
            let avgDisplay, minDisplay, maxDisplay;
            
            if (metricType === 'cpk') {
                avgDisplay = data.average.toFixed(2);
                minDisplay = data.min.toFixed(2);
                maxDisplay = data.max.toFixed(2);
            } else if (metricType === 'ppm') {
                avgDisplay = Math.round(data.average);
                minDisplay = Math.round(data.min);
                maxDisplay = Math.round(data.max);
            } else {
                avgDisplay = data.average.toFixed(1) + '%';
                minDisplay = data.min.toFixed(1) + '%';
                maxDisplay = data.max.toFixed(1) + '%';
            }

            // Handle special cases for PPM (reverse min/max display)
            if (metricType === 'ppm') {
                document.getElementById(`${metricType}Average`).textContent = avgDisplay + ' PPM';
                document.getElementById(`${metricType}Min`).textContent = minDisplay + ' PPM';
                document.getElementById(`${metricType}Max`).textContent = maxDisplay + ' PPM';
            } else {
                document.getElementById(`${metricType}Average`).textContent = avgDisplay;
                document.getElementById(`${metricType}Min`).textContent = minDisplay;
                document.getElementById(`${metricType}Max`).textContent = maxDisplay;
            }
            
            document.getElementById(`${metricType}Count`).textContent = data.count;
            
            const trendEl = document.getElementById(`${metricType}Trend`);
            const trendText = getTrendText(data.trend);
            trendEl.textContent = trendText;
            trendEl.className = `trend-indicator trend-${data.trend}`;
        }

        function updateChart() {
            const line = document.getElementById('lineSelect').value;
            const period = parseInt(document.getElementById('periodSelect').value);
            
            const data = MockDataGenerator.generateTimeSeriesData(currentMetric, period);
            
            trendsChart.data.datasets[0].data = data;
            trendsChart.data.datasets[0].label = getMetricLabel(currentMetric);
            
            // Update chart styling based on metric
            const colors = {
                rft: { border: 'rgb(72, 187, 120)', bg: 'rgba(72, 187, 120, 0.1)' },
                cpk: { border: 'rgb(66, 153, 225)', bg: 'rgba(66, 153, 225, 0.1)' },
                fpy: { border: 'rgb(237, 137, 54)', bg: 'rgba(237, 137, 54, 0.1)' },
                ppm: { border: 'rgb(229, 62, 62)', bg: 'rgba(229, 62, 62, 0.1)' },
                efficiency: { border: 'rgb(56, 178, 172)', bg: 'rgba(56, 178, 172, 0.1)' }
            };
            
            if (colors[currentMetric]) {
                trendsChart.data.datasets[0].borderColor = colors[currentMetric].border;
                trendsChart.data.datasets[0].backgroundColor = colors[currentMetric].bg;
                trendsChart.data.datasets[0].pointBackgroundColor = colors[currentMetric].border;
            }
            
            trendsChart.update('active');
        }

        function updateAIInsights() {
            const line = document.getElementById('lineSelect').value;
            
            // Update AI predictions and recommendations
            document.getElementById('aiPrediction').textContent = aiEngine.generatePrediction({});
            document.getElementById('aiClassification').textContent = aiEngine.classifyPerformance({});
            document.getElementById('aiOptimization').textContent = aiEngine.generateOptimization(line);
            document.getElementById('aiRisk').innerHTML = aiEngine.assessRisk({});
            
            // Update performance cards
            const lines = ['VCE Line', 'HDEP-C1', 'HDEP-C2', 'MDEP'];
            const topLine = lines[Math.floor(Math.random() * lines.length)];
            const rftScore = (95 + Math.random() * 4).toFixed(1);
            document.getElementById('topPerformer').textContent = `${topLine} - ${rftScore}% RFT`;
            
            const trends = ['↗️ Improving Overall', '📊 Stable Performance', '📈 Trending Upward', '⚡ Optimizing'];
            document.getElementById('trendStatus').textContent = trends[Math.floor(Math.random() * trends.length)];
        }

        function updateAlerts() {
            const alertPanel = document.getElementById('alertPanel');
            const alertContent = document.getElementById('alertContent');
            
            // Randomly show alerts
            if (Math.random() < 0.3) {
                const alerts = [
                    'VCE Line: RFT below 95% for 2 consecutive shifts',
                    'HDEP-C2: CPK trending downward, review process parameters',
                    'Night Shift: Increased defect rate detected in connector assembly'
                ];
                
                alertContent.textContent = alerts[Math.floor(Math.random() * alerts.length)];
                alertPanel.style.display = 'block';
            } else {
                alertPanel.style.display = 'none';
            }
        }

        function getTrendText(trend) {
            const trendTexts = {
                up: '↗️ Improving',
                down: '↘️ Declining', 
                stable: '➡️ Stable'
            };
            return trendTexts[trend] || 'Analyzing...';
        }

        function getMetricLabel(metric) {
            const labels = {
                rft: 'Right First Time (%)',
                cpk: 'Process Capability (CPK)',
                fpy: 'First Pass Yield (%)',
                ppm: 'Defect Rate (PPM)',
                efficiency: 'Line Efficiency (%)'
            };
            return labels[metric] || 'Performance Metric';
        }

        function showNoData(message) {
            const metrics = ['rft', 'cpk', 'fpy', 'ppm', 'audit', 'efficiency'];
            metrics.forEach(metricType => {
                document.getElementById(`${metricType}Average`).textContent = '--';
                document.getElementById(`${metricType}Min`).textContent = '--';
                document.getElementById(`${metricType}Max`).textContent = '--';
                document.getElementById(`${metricType}Count`).textContent = '0';
                
                const trendEl = document.getElementById(`${metricType}Trend`);
                trendEl.textContent = 'No data';
                trendEl.className = 'trend-indicator trend-stable';
            });
        }
    </script>
</body>
</html>
