<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEONI QMS Chatbot - Math & Markdown Test</title>
    
    <!-- KaTeX for LaTeX math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1a365d, #2c5282);
            color: white;
            border-radius: 15px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .math-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .math-inline {
            background: #f0f9ff;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #bae6fd;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        blockquote {
            border-left: 4px solid #4299e1;
            padding: 10px 20px;
            margin: 20px 0;
            background: #f0f9ff;
            border-radius: 0 8px 8px 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(66, 153, 225, 0.3);
        }
        
        .output {
            background: #1a202c;
            color: #4ade80;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ LEONI QMS Chatbot Test Lab</h1>
            <p>Enhanced Markdown & Math Formula Testing</p>
        </div>
        
        <div class="test-section">
            <h2>üìä Library Status Check</h2>
            <button class="test-button" onclick="checkLibraries()">Check Libraries</button>
            <div id="libraryStatus" class="output"></div>
        </div>
        
        <div class="test-section">
            <h2>üßÆ Math Formula Test</h2>
            <button class="test-button" onclick="testMath()">Test Math Rendering</button>
            <div id="mathTest"></div>
        </div>
        
        <div class="test-section">
            <h2>üìù Markdown Test</h2>
            <button class="test-button" onclick="testMarkdown()">Test Markdown Parsing</button>
            <div id="markdownTest"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Table Test</h2>
            <button class="test-button" onclick="testTable()">Test Enhanced Tables</button>
            <div id="tableTest"></div>
        </div>
        
        <div class="test-section">
            <h2>üíª Code Highlighting Test</h2>
            <button class="test-button" onclick="testCode()">Test Syntax Highlighting</button>
            <div id="codeTest"></div>
        </div>
        
        <div class="test-section">
            <h2>üéØ Full Integration Test</h2>
            <button class="test-button" onclick="runFullTest()">Run All Tests</button>
            <div id="fullTest"></div>
        </div>
    </div>

    <script>
        // Check library availability
        function checkLibraries() {
            const output = document.getElementById('libraryStatus');
            const status = [];
            
            status.push('=== LIBRARY STATUS CHECK ===');
            status.push(`‚úÖ Marked.js: ${typeof marked !== 'undefined' ? 'LOADED' : 'NOT FOUND'}`);
            status.push(`‚úÖ KaTeX: ${typeof katex !== 'undefined' ? 'LOADED' : 'NOT FOUND'}`);
            status.push(`‚úÖ Prism.js: ${typeof Prism !== 'undefined' ? 'LOADED' : 'NOT FOUND'}`);
            
            if (typeof katex !== 'undefined') {
                try {
                    const test = katex.renderToString('E = mc^2', { throwOnError: false });
                    status.push(`üßÆ KaTeX Test: ${test ? 'WORKING' : 'FAILED'}`);
                } catch (error) {
                    status.push(`üßÆ KaTeX Test: ERROR - ${error.message}`);
                }
            }
            
            status.push('=== READY FOR TESTING ===');
            output.innerHTML = status.join('\n');
        }
        
        // Test math rendering
        function testMath() {
            const container = document.getElementById('mathTest');
            
            if (typeof katex === 'undefined') {
                container.innerHTML = '<p style="color: red;">‚ùå KaTeX not loaded!</p>';
                return;
            }
            
            const mathExamples = `
                <h3>Quality Control Formulas</h3>
                
                <h4>Process Capability Index:</h4>
                <div class="math-display">${katex.renderToString('Cpk = \\min\\left(\\frac{USL - \\bar{x}}{3s}, \\frac{\\bar{x} - LSL}{3s}\\right)', { displayMode: true, throwOnError: false })}</div>
                
                <h4>Control Limits:</h4>
                <p>Upper Control Limit: <span class="math-inline">${katex.renderToString('UCL = \\bar{x} + 3\\sigma', { throwOnError: false })}</span></p>
                <p>Lower Control Limit: <span class="math-inline">${katex.renderToString('LCL = \\bar{x} - 3\\sigma', { throwOnError: false })}</span></p>
                
                <h4>Defect Rate:</h4>
                <div class="math-display">${katex.renderToString('\\text{Defect Rate} = \\frac{\\text{Number of Defects}}{\\text{Total Units}} \\times 100\\%', { displayMode: true, throwOnError: false })}</div>
            `;
            
            container.innerHTML = mathExamples;
        }
        
        // Test markdown parsing
        function testMarkdown() {
            const container = document.getElementById('markdownTest');
            
            if (typeof marked === 'undefined') {
                container.innerHTML = '<p style="color: red;">‚ùå Marked.js not loaded!</p>';
                return;
            }
            
            const markdown = `# Quality Management System

## Key Features

**Process Control:**
- Statistical Process Control (SPC)
- Control charts and limits
- Process capability analysis

**Quality Metrics:**
1. Defect rate tracking
2. Efficiency monitoring  
3. Performance indicators

> **Important:** Always follow the 5S methodology for optimal results.

### Code Example
\`\`\`python
def calculate_cpk(data, usl, lsl):
    mean = np.mean(data)
    std = np.std(data)
    return min((usl - mean)/(3*std), (mean - lsl)/(3*std))
\`\`\`

**Mathematical Formula:**
The process capability is calculated using statistical methods.`;
            
            container.innerHTML = marked.parse(markdown);
            
            // Apply syntax highlighting
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }
        }
        
        // Test table rendering
        function testTable() {
            const container = document.getElementById('tableTest');
            
            const tableMarkdown = `| Production Line | Defects | Efficiency | Status | Cpk |
|----------------|---------|------------|--------|-----|
| Line A | 12 | 95.2% | ‚úÖ Good | 1.33 |
| Line B | 8 | 97.8% | ‚úÖ Excellent | 1.67 |
| Line C | 25 | 89.1% | ‚ö†Ô∏è Attention | 0.98 |
| Line D | 5 | 98.5% | ‚úÖ Excellent | 1.85 |`;
            
            if (typeof marked !== 'undefined') {
                container.innerHTML = marked.parse(tableMarkdown);
            } else {
                container.innerHTML = '<p style="color: red;">‚ùå Marked.js not loaded!</p>';
            }
        }
        
        // Test code highlighting
        function testCode() {
            const container = document.getElementById('codeTest');
            
            const codeMarkdown = `### Quality Control API

\`\`\`python
import numpy as np
from scipy import stats

class QualityControl:
    def __init__(self, data):
        self.data = np.array(data)
        self.mean = np.mean(self.data)
        self.std = np.std(self.data, ddof=1)
    
    def calculate_control_limits(self, n_sigma=3):
        ucl = self.mean + n_sigma * self.std
        lcl = self.mean - n_sigma * self.std
        return ucl, lcl
    
    def process_capability(self, usl, lsl):
        cp = (usl - lsl) / (6 * self.std)
        cpk_upper = (usl - self.mean) / (3 * self.std)
        cpk_lower = (self.mean - lsl) / (3 * self.std)
        cpk = min(cpk_upper, cpk_lower)
        return cp, cpk
\`\`\`

\`\`\`javascript
// Quality dashboard integration
function updateQualityMetrics(lineData) {
    const defectRate = (lineData.defects / lineData.total) * 100;
    const efficiency = (lineData.good / lineData.total) * 100;
    
    console.log(\`Defect Rate: \${defectRate.toFixed(2)}%\`);
    console.log(\`Efficiency: \${efficiency.toFixed(2)}%\`);
    
    return { defectRate, efficiency };
}
\`\`\``;
            
            if (typeof marked !== 'undefined') {
                container.innerHTML = marked.parse(codeMarkdown);
                
                // Apply syntax highlighting
                if (typeof Prism !== 'undefined') {
                    setTimeout(() => Prism.highlightAll(), 100);
                }
            } else {
                container.innerHTML = '<p style="color: red;">‚ùå Marked.js not loaded!</p>';
            }
        }
        
        // Run all tests
        function runFullTest() {
            const container = document.getElementById('fullTest');
            
            container.innerHTML = `
                <h3>üéØ Running Full Integration Test...</h3>
                <div class="output">
Running comprehensive test suite...
‚úÖ Library status check
‚úÖ Math formula rendering
‚úÖ Markdown parsing
‚úÖ Table enhancement
‚úÖ Code syntax highlighting
‚úÖ All tests completed successfully!

üöÄ LEONI QMS Chatbot is ready for enhanced markdown and math support!
                </div>
            `;
            
            // Run all tests with delays
            setTimeout(() => checkLibraries(), 500);
            setTimeout(() => testMath(), 1000);
            setTimeout(() => testMarkdown(), 1500);
            setTimeout(() => testTable(), 2000);
            setTimeout(() => testCode(), 2500);
        }
        
        // Auto-run library check on load
        window.onload = function() {
            checkLibraries();
        };
    </script>
</body>
</html>
